<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SVOX Pico libpicotts: Picospho</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SVOX Pico libpicotts
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Picospho</div>  </div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="autotoc_md23"></a>
Algorithmic description</h1>
<p>The main function, sphoStep, is divided into the subprocesses (processing states) described further down.</p>
<h2><a class="anchor" id="autotoc_md24"></a>
Flow control:</h2>
<p>The processing flow is controlled by setting</p><ul>
<li>'procState' : the next state to be processed</li>
<li>'feedFollowState' : the state to be processed after the feed state (the feed state is treated like a primitive "subroutine")</li>
<li>some other flags</li>
</ul>
<h2><a class="anchor" id="autotoc_md25"></a>
Buffering:</h2>
<ul>
<li>The input items are mainly stored and processed in two buffers, collectively called 'inBuf'<ul>
<li>cbuf : unstructured buffer containing item contents</li>
<li>headx : structured buffer containing item heads, each expanded by a pointer to the item contents and space for a boundary potentially to be inserted (to the left of the original item)</li>
</ul>
</li>
<li>For transduction, phonemes and their position are extracted from inBuf into<ul>
<li>phonBuf, processed there, and the resulting phonemes realigned with inBuf.</li>
</ul>
</li>
<li>Word items are split into syllables, stored in<ul>
<li>sylBuf</li>
</ul>
</li>
<li>Items to be output are stored in outBuf</li>
</ul>
<h2><a class="anchor" id="autotoc_md26"></a>
Windowing:</h2>
<p>Optimal solutions are achieved if a whole sentence is processed at once. However, if any of the buffers are too small, only sentence parts are processed. To improve the quality of such sub-optimal solutions, a moving-window-with-overlap is applied:</p><ul>
<li>[0,headxReadPos[ : the window considered for transduction</li>
<li>[activeStartPos,activeEndPos[ : the "active" subrange of the window actually used for output</li>
<li>penultima : the position (within the active range) that should be used as new window start when shifting the window</li>
</ul>
<p>After PROCESS_PARSE: 0 activeStartPos penultima activeEndPos headxReadPos headxWritePos | | | | | | |----------&mdash;=================================------------&mdash;| ['-&mdash;': context '====' : active subrange)</p>
<p>After PROCESS_SHIFT: 0 activeStartPos headWritePos | | | | |---------&mdash;... (only left context is known; new active range, penultima, and right context to be established at next parse)</p>
<h2><a class="anchor" id="autotoc_md27"></a>
Processing states:</h2>
<ul>
<li>INIT : initialize state variables</li>
<li>COLLECT : collect items into internal buffers ("inBuf")</li>
<li>PROCESS_PARSE : go through inBuf items and extract position/phoneme pairs into phoneme buffer 'phonBuf' word boundary phonemes are inserted between words</li>
<li>PROCESS_TRANSDUCE : transduce phonBuf</li>
<li>PROCESS_BOUNDS : go through inBuf items again and match against transduced pos/phoneme this is the first round of alignment, only inserting/deleting/modifying bounds, according to<ul>
<li>existing BOUND items</li>
<li>newly produced word bounds separating WORDPHON items</li>
<li>bound upgrades/downgrades from transduction</li>
<li>bound upgrades/downgrades/insertions from SIL command items (originating e.g. from &lt;break&gt; text commands) all relevant bounds are placed in the corresponding headx extention; original bound items become invalid.</li>
</ul>
</li>
<li>PROCESS_RECOMB : go through inBuf items again and match against transduced pos/phoneme this is the second round of alignment, treating non-BOUND items<ul>
<li>WORDPHONs are broken into syllables by "calling" PROCESS_SYL</li>
<li>"side-bounds" (in the headx extension) are output by "calling" FEED</li>
<li>BOUND items are consumed with no effect</li>
<li>other items are output unchanged "calling" FEED</li>
</ul>
</li>
<li>PROCESS_SYL : the WORDPHON coming from RECOMB is matched against the phonBuf and (new) SYLLPHON items are created. (the original wordphon is consumed)</li>
<li>FEED : feeds one item and returns to spho-&gt;feedFollowState</li>
<li>SHIFT : items in inBuf are shifted left to make room for new items. If a sentence doesn't fit inBuf in its entirety, left and/or right contexts are kept so they can be considered in the next transduction.</li>
</ul>
<p>itemtype, iteminfo1, iteminfo2, content -&gt; TYPE(INFO1,INFO2)content in the following</p>
<h1><a class="anchor" id="autotoc_md28"></a>
items input</h1>
<p>processed:</p>
<ul>
<li>WORDPHON(POS,WACC)phon</li>
<li>BOUND(BOUNDstrength,BOUNDtype)</li>
</ul>
<p>unprocessed:</p><ul>
<li>all other item types are forwared through the PU without modification</li>
<li>POS a the single, unambiguous POS</li>
</ul>
<p>cf. <a class="el" href="picodata_8h.html">picodata.h</a> for</p><ul>
<li>WACC (sentence-level accent (aka prominence)) PICODATA_ACC0 PICODATA_ACC1 PICODATA_ACC2 (&lt;- maybe mapped to ACC1, ie. no ACC2 in output) PICODATA_ACC3</li>
<li>BOUNDstrength PICODATA_ITEMINFO1_BOUND_SBEG (sentence start) PICODATA_ITEMINFO1_BOUND_SEND (at sentence end) PICODATA_ITEMINFO1_BOUND_TERM (replaces a flush) PICODATA_ITEMINFO1_BOUND_PHR0 (no break) PICODATA_ITEMINFO1_BOUND_PHR1 (primary boundary) PICODATA_ITEMINFO1_BOUND_PHR2 (short break) PICODATA_ITEMINFO1_BOUND_PHR3 (secondary phrase boundary, no break)</li>
<li>BOUNDtype (actually phrase type of the following phrase) PICODATA_ITEMINFO2_BOUNDTYPE_P (non-terminal phrase) PICODATA_ITEMINFO2_BOUNDTYPE_T (terminal phrase) PICODATA_ITEMINFO2_BOUNDTYPE_Q (question terminal phrase) PICODATA_ITEMINFO2_BOUNDTYPE_E (exclamation terminal phrase)</li>
</ul>
<p>output sequence (without CMDs):</p>
<p>&lt;output&gt; = { BOUND(BOUND_SBEG,PHRASEtype) &lt;sentence&gt; BOUND(BOUND_SEND,..)} BOUND(BOUND_TERM,..)</p>
<p>&lt;sentence&gt; = &lt;phrase&gt; { BOUND(BOUND_PHR1|2|3,PHRASEtype) &lt;phrase&gt; }</p>
<p>&lt;phrase&gt; = WORDPHON(POS,ACC)phon { WORDPHON(POS,ACC)phon }</p>
<p>mapping ACC &amp; word-level stress to syllable accent value</p>
<p>ACC0 prim -&gt; 0 ACC1 prim -&gt; 1 ACC2 prim -&gt; 2 ACC3 prim -&gt; 3</p>
<p>ACC0 sec -&gt; 0 ACC1 sec -&gt; 4 ACC2 sec -&gt; 4 ACC3 sec -&gt; 4</p>
<p>Mapping of values to FST symbol id (has to identical to the symbol table used when compiling the FST)</p>
<p>Value FST symbol id phoneme_id -&gt; phoneme_id + 256 * PICOKFST_PLANE_PHONEMES POS_id -&gt; POS_id + 256 * PICOKFST_PLANE_POS phrasetype_id -&gt; phrasetype_id + 256 * PICOKFST_PLANE_PHRASETYPES accentlevel_id -&gt; accentlevel_id + 256 * PICOKFST_PLANE_ACCENTS</p>
<h1><a class="anchor" id="autotoc_md29"></a>
minimal input size (before processing starts)</h1>
<p>processing (ie. sequencially applying spho transducers to phoneme sequence composed of</p><ul>
<li>phonemes inside WORDPHON items and</li>
<li>pseudo-phonemes derived from boundaries and POS) is possible with</li>
</ul>
<p>one phrase, consisting of a sequence of maximal 30 non-PUNC items terminated by a PUNC item. A PUNC is artificially enforced if needed to start processing.</p>
<ul>
<li>as long as the internal buffer is empty, non-processed item types can be processed immediately</li>
</ul>
<h1><a class="anchor" id="autotoc_md30"></a>
items output</h1>
<ul>
<li><p class="startli">BOUND(BOUNDstrength,BOUNDtype)</p>
<p class="startli">bound strength may be changed by the fsts</p>
<p class="startli">in addition, BOUNDs of BOUNDstrength = PHR0 are inserted to mark word boundaries</p>
</li>
<li>SYLLPHON(POS,ACC)phon where POS is only set for the first syllable of a word, otherwise NA</li>
</ul>
<h1><a class="anchor" id="autotoc_md31"></a>
other limitations</h1>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Apr 23 2021 05:17:41 for SVOX Pico libpicotts by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
